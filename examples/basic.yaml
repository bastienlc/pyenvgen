# Example pyenvgen schema
# Demonstrates the 'default' generation rule with various types and validations.

variables:
  APP_NAME:
    type: str
    description: "Name of the application"
    generation:
      rule: default
      value: "my-app"
    validation:
      length:
        min: 1
        max: 64

  APP_PORT:
    type: int
    description: "Port the application listens on"
    generation:
      rule: default
      value: "8080"
    validation:
      range:
        min: 1
        max: 65535

  DEBUG:
    type: bool
    description: "Enable debug mode"
    generation:
      rule: default
      value: "false"

  LOG_LEVEL:
    type: str
    description: "Logging level"
    generation:
      rule: default
      value: "INFO"
    validation:
      one_of:
        choices: ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"]

  RATE_LIMIT:
    type: float
    description: "Request rate limit (req/s)"
    generation:
      rule: default
      value: "100.0"
    validation:
      range:
        min: 0.1
        max: 10000.0

  SECRET_KEY:
    type: str
    description: "Internal secret used for signing â€” not exported"
    internal: true
    generation:
      rule: default
      value: "change-me-in-production"
    validation:
      length:
        min: 8

  # --- command rule: run a shell command and capture stdout ---

  GIT_SHA:
    type: str
    description: "Short git commit SHA of the current HEAD"
    generation:
      rule: command
      command: "git rev-parse --short HEAD"

  # --- default rule with Jinja: compose values from already-generated variables ---

  DATABASE_URL:
    type: str
    description: "Full database connection URL built from host and port"
    generation:
      rule: default
      value: "postgres://app:password@{{ APP_NAME }}:5432/app"

  # --- openssl rule: generate cryptographic material ---

  FERNET_KEY:
    type: str
    description: "Fernet symmetric encryption key"
    generation:
      rule: openssl
      command: fernet

  SESSION_SECRET:
    type: str
    description: "32-byte random hex session secret"
    generation:
      rule: openssl
      command: random
      args:
        length: 32
        encoding: hex

  TLS_PRIVATE_KEY:
    type: str
    description: "EC P-256 private key in PEM format"
    internal: true
    generation:
      rule: openssl
      command: ec
      args:
        curve: secp256r1
        encoding: pem

  WG_PRIVATE_KEY:
    type: str
    description: "WireGuard-compatible X25519 private key (base64-encoded raw bytes)"
    internal: true
    generation:
      rule: openssl
      command: x25519
